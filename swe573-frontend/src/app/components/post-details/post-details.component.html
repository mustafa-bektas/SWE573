<div *ngIf="loading" class="spinner-container d-flex justify-content-center align-items-center my-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<div *ngIf="!loading" class="container my-5">
  <!-- Post Title and Details -->
  <div class="card mb-4 shadow">
    <div class="card-header">
      <h2>{{ post.title }}</h2>
      <small class="text-muted">{{ post.date | date }}</small>
    </div>
    <div class="card-body">
      <div class="row">
        <!-- Image and Description -->
        <div class="col-md-7">
          <!-- Mystery Object Image -->
          <img *ngIf="post.mysteryObject.image" [src]="'data:image/png;base64,' + post.mysteryObject.image"
               class="img-fluid mb-3 rounded" alt="Mystery Object Image"
               style="object-fit: cover; width: 100%;">

          <!-- Post Description -->
          <p>{{ post.description }}</p>

          <!-- Tags -->
          <div class="mt-3">
            <strong>Tags:</strong>
            <span *ngFor="let tag of post.tags" class="badge bg-primary ms-1 fw-normal rounded-pill">{{ tag }}</span>
          </div>
        </div>

        <!-- Mystery Object Details -->
        <div *ngIf="post.mysteryObject" class="col-md-5">
          <h3>Mystery Object Details</h3>
          <div class="border p-3 rounded bg-light">
            <p><strong>Description:</strong> {{ post.mysteryObject.description }}</p>
            <p><strong>Written Text:</strong> {{ post.mysteryObject.writtenText }}</p>
            <p><strong>Color:</strong> {{ post.mysteryObject.color }}</p>
            <p><strong>Shape:</strong> {{ post.mysteryObject.shape }}</p>
            <p><strong>Description of Parts:</strong> {{ post.mysteryObject.descriptionOfParts }}</p>
            <p><strong>Location:</strong> {{ post.mysteryObject.location }}</p>
            <p><strong>Hardness:</strong> {{ post.mysteryObject.hardness }}</p>
            <p><strong>Time Period:</strong> {{ post.mysteryObject.timePeriod }}</p>
            <p><strong>Smell:</strong> {{ post.mysteryObject.smell }}</p>
            <p><strong>Taste:</strong> {{ post.mysteryObject.taste }}</p>
            <p><strong>Texture:</strong> {{ post.mysteryObject.texture }}</p>
            <p><strong>Value:</strong> {{ post.mysteryObject.value | currency }}</p>
            <p><strong>Origin of Acquisition:</strong> {{ post.mysteryObject.originOfAcquisition }}</p>
            <p><strong>Pattern:</strong> {{ post.mysteryObject.pattern }}</p>
            <p><strong>Brand:</strong> {{ post.mysteryObject.brand }}</p>
            <p><strong>Print:</strong> {{ post.mysteryObject.print }}</p>
            <p><strong>Functionality:</strong> {{ post.mysteryObject.functionality }}</p>
            <p><strong>Image Licenses:</strong> {{ post.mysteryObject.imageLicenses }}</p>
            <p><strong>Markings:</strong> {{ post.mysteryObject.markings }}</p>
            <p><strong>Handmade:</strong> {{ post.mysteryObject.handmade ? 'Yes' : 'No' }}</p>
            <p><strong>One of a Kind:</strong> {{ post.mysteryObject.oneOfAKind ? 'Yes' : 'No' }}</p>
            <p><strong>Size (X, Y, Z):</strong> {{ post.mysteryObject.sizeX }}, {{ post.mysteryObject.sizeY }}, {{ post.mysteryObject.sizeZ }}</p>
            <p><strong>Weight:</strong> {{ post.mysteryObject.weight }} kg</p>
            <p><strong>Item Condition:</strong> {{ post.mysteryObject.itemCondition }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Comment -->
  <div class="card shadow mb-4">
    <div class="card-header">
      <h3>Add a Comment</h3>
    </div>
    <div class="card-body">
      <textarea [(ngModel)]="commentContent" class="form-control mb-2" rows="3" placeholder="Write your comment here..."></textarea>
      <button (click)="submitComment()" class="btn btn-primary">Submit Comment</button>
    </div>
  </div>

  <!-- Comments Section -->
  <div class="card shadow">
    <div class="card-header">
      <h3>Comments</h3>
    </div>
    <div class="card-body">
      <p *ngIf="comments.length === 0" class="text-muted">No comments yet. Be the first to comment!</p>
      <ul *ngIf="comments.length > 0" class="list-group list-group-flush">
        <li *ngFor="let comment of comments" class="list-group-item">
          <div>
            <strong>{{ comment.author }}</strong>
            <p>{{ comment.content }}</p>
            <!-- Reply Button -->
            <button class="btn btn-link" (click)="replyContentMap[comment.id] = replyContentMap[comment.id] || ''">Reply</button>
          </div>

          <!-- Nested Replies -->
          <ul *ngIf="comment.replies.length > 0" class="list-group list-group-flush">
            <li *ngFor="let reply of comment.replies" class="list-group-item ms-4">
              <strong>{{ reply.author }}</strong>
              <p>{{ reply.content }}</p>
            </li>
          </ul>

          <!-- Reply Input Field -->
          <div *ngIf="replyContentMap[comment.id] !== undefined" class="mt-3">
            <textarea [(ngModel)]="replyContentMap[comment.id]" class="form-control mb-2" rows="2" placeholder="Write your reply here..."></textarea>
            <button (click)="submitReply(comment.id)" class="btn btn-primary">Submit Reply</button>
          </div>

        </li>
      </ul>
    </div>
  </div>
</div>

